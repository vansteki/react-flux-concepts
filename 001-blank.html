<!DOCTYPE html>
<html>
<head>
	<style type="text/css">

	</style>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
	<script src="https://fb.me/react-0.12.2.js"></script>
	<script src="https://fb.me/JSXTransformer-0.12.2.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react-router/0.11.6/react-router.js"></script>
    <script src="http://kenwheeler.github.io/mcfly/McFly.js"></script>
</head>
<body>
	<script type="text/jsx">
	var Flux = new McFly();
	var _items = [];


	var CardStore = Flux.createStore(
		{
			getItems: function() {
				return _items;
			}
		}, function(payload) {
				if (payload.actionType === 'CARD.ADD_ITEM') {
					_items.push(payload.content);
					CardStore.emitChange();
				}
				if (payload.actionType === 'CARD.CLEAR_ITEM') {
					_items = [];
					CardStore.emitChange();
				}
		}
	);

	var CardActions = Flux.createActions({
		addItem: function(itemContent) {
			return {
				actionType: 'CARD.ADD_ITEM',
				content: itemContent
			}
		},
		clearItem: function() {
			return {
				actionType: 'CARD.CLEAR_ITEM'
			}
		}
	});

	var CardController = React.createClass({
		mixins: [CardStore.mixin],
		getInitialState: function() {
			return this.getItems();
		},
		storeDidChange: function() {
			console.log('storeDidChange')
			this.setState(this.getItems());
		},
		render: function() {
			return <Card items={this.state.items} />;
		},
		getItems: function() {
			return {
				items: CardStore.getItems()
			}
		}
	});

	var Card = React.createClass({
		 addItem: function() {
		 	console.log('Reaction.addItem')
			CardActions.addItem({
				name: 'an new item > ' + +new Date
			});
		 },
		 clearItem: function() {
		 	CardActions.clearItem();
		 },
		 render: function() {
		 	console.log(this.props)
			 return (
				<div>
					<div>Items:</div>
					<ul>
					{
						this.props.items.map(function(v,k) {
							return <li> {v} </li>
						})
					}
					</ul>
					<button onClick={this.addItem}> Buy </button>
					<button onClick={this.clearItem}> Clear </button>
				</div>
			 );
		 }
		});
		React.render(< CardController/>, document.body);
	</script>
</body>
</html>
